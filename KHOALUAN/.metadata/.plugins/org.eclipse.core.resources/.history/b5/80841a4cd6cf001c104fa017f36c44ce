package cntt.trang.controller;

import java.util.ArrayList;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import cntt.trang.bean.DoanhNghiep;
import cntt.trang.dao.AdminDAO;
import cntt.trang.dao.DoanhNghiepDAO;
import cntt.trang.dao.HashMD5;
import cntt.trang.dao.LinhVucHoatDongCap2DAO;
import cntt.trang.dao.LoaiHinhDoanhNghiepDAO;
import cntt.trang.dao.XaPhuongDAO;

@Controller
@RequestMapping(value = "/admin")
public class AdminController {
	@RequestMapping(value= {"/dangnhap"}, method=RequestMethod.GET)
    public String displayDangNhap(Model model,HttpSession session,HttpServletRequest  request,HttpServletResponse response) {
	 	try {
	 		response.setContentType("text/html;charset=UTF-8");
	 		request.setCharacterEncoding("UTF-8");
	 		
	 		model.addAttribute("title", "Đăng nhập tài khoản quản trị");
	    	return "admin/dangnhap";
		} catch (Exception e) {
			e.printStackTrace();
			return null;
		}
       
    }
	@RequestMapping(value= {"/dangnhap"}, method=RequestMethod.POST)
    public String dangNhap(Model model,HttpSession session,HttpServletRequest  request,HttpServletResponse response) {
	 	try {
	 		response.setContentType("text/html;charset=UTF-8");
	 		request.setCharacterEncoding("UTF-8");
	 		
	 		AdminDAO adminDAO= new AdminDAO();
	 		HashMD5 hashMD5=new HashMD5();
	 		String username=request.getParameter("txtUsername");
	 		String password=request.getParameter("txtPassword");
	 		
	 		if(adminDAO.KiemTraDangNhap(username, hashMD5.convertHashToString(password))!= null) {
	 			session.setAttribute("admin",adminDAO.KiemTraDangNhap(username, hashMD5.convertHashToString(password)));
	 			return "redirect:/admin/doanhnghiep";
	 		}
	 		else model.addAttribute("msg", "Tên đăng nhập hoặc mật khẩu sai");
	 		
	 		model.addAttribute("title", "Đăng nhập tài khoản quản trị");
	    	return "admin/dangnhap";
		} catch (Exception e) {
			e.printStackTrace();
			return null;
		}
       
    }
	@RequestMapping(value= {"/dangxuat"}, method=RequestMethod.GET)
    public String dangXuat(Model model,HttpSession session,HttpServletRequest  request,HttpServletResponse response) {
	 	try {
	 		response.setContentType("text/html;charset=UTF-8");
	 		request.setCharacterEncoding("UTF-8");
	 		
	 		session.removeAttribute("admin");
	 		return "redirect:/trangchu";
	 		
		} catch (Exception e) {
			e.getStackTrace();
			return null;
		}
       
    }
	@RequestMapping(value= {"/doanhnghiep"}, method=RequestMethod.GET)
    public String doanhNghiep(Model model,HttpSession session,HttpServletRequest  request,HttpServletResponse response) {
	 	try {
	 		response.setContentType("text/html;charset=UTF-8");
	 		request.setCharacterEncoding("UTF-8");
	 		
	 		DoanhNghiepDAO doanhNghiepDAO=new DoanhNghiepDAO();
	 		ArrayList<DoanhNghiep> doanhNghiepChuaDuyets=doanhNghiepDAO.getAllDoanhNghiepChuaDuyet();
	 		ArrayList<DoanhNghiep> doanhNghiepDaDuyets=doanhNghiepDAO.getAllDoanhNghiepDaDuyet();
	 		model.addAttribute("doanhNghiepChuaDuyets",doanhNghiepChuaDuyets);
	 		model.addAttribute("doanhNghiepDaDuyets",doanhNghiepDaDuyets);
	 		model.addAttribute("title", "Doanh Nghiệp");
	    	return "admin/doanhnghiep/list";
		} catch (Exception e) {
			e.printStackTrace();
			return null;
		}
       
    }
	@RequestMapping(value= {"/doanhnghiep/chitiet"}, method=RequestMethod.GET)
    public String chiTietDoanhNghiep(Model model,HttpSession session,HttpServletRequest  request,HttpServletResponse response) {
	 	try {
	 		response.setContentType("text/html;charset=UTF-8");
	 		request.setCharacterEncoding("UTF-8");
	 		
	 		DoanhNghiepDAO doanhNghiepDAO=new DoanhNghiepDAO();
	 		XaPhuongDAO xaPhuongDAO= new XaPhuongDAO();
	 		LinhVucHoatDongCap2DAO linhVucHoatDongCap2DAO=new LinhVucHoatDongCap2DAO();
	 		LoaiHinhDoanhNghiepDAO loaiHinhDoanhNghiepDAO=new LoaiHinhDoanhNghiepDAO();
	 		String maDoanhNghiep=request.getParameter("id");
	 		DoanhNghiep doanhNghiep=doanhNghiepDAO.getDoanhNghiepById(Long.parseLong(maDoanhNghiep));
	 		String anh[]= {"https://my-test-11.slatic.net/p/b9d3ee9a3752b77bfd88a7397a55dfe4.jpg","https://anh.24h.com.vn/upload/4-2014/images/2014-10-28/1414476250-15.jpg","https://photo-cms-kienthuc.zadn.vn/zoom/800/uploaded/hongngan/2018_02_21/f/1_duot.jpg"};
//	 		if(doanhNghiep.getGiayChungNhan()!=null)
//	 			if(!doanhNghiep.getGiayChungNhan().equals(""))
//	 			anh=doanhNghiep.getGiayChungNhan().split(";");
	 		
	 		model.addAttribute("doanhNghiep",doanhNghiep);
	 		model.addAttribute("xaPhuongDAO",xaPhuongDAO);
	 		model.addAttribute("linhVucHoatDongCap2DAO",linhVucHoatDongCap2DAO);
	 		model.addAttribute("loaiHinhDoanhNghiepDAO",loaiHinhDoanhNghiepDAO);
	 		model.addAttribute("anh",anh);
	 		model.addAttribute("title", "Chi Tiết Doanh Nghiệp");
	    	return "admin/doanhnghiep/chitiet";
		} catch (Exception e) {
			e.printStackTrace();
			return null;
		}
       
    }
}
